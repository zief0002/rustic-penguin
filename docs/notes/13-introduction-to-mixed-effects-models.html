<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-02-13">

<title>EPsy 8252 - Introduction to Mixed-Effects Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="../site_libs/pagedtable/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable/js/pagedtable.js"></script>
<script src="https://kit.fontawesome.com/e5da75ca36.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../assets/sticky-notes.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">EPsy 8252</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assignments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="../assignments.html">
 <span class="dropdown-text">Assignment Due Dates</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-01-introduction-to-quarto.html">
 <span class="dropdown-text">Assignment 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-02-polynomial-effects.html">
 <span class="dropdown-text">Assignment 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-03-evidence-and-model-selection.html">
 <span class="dropdown-text">Assignment 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-04-logarithmic-transformations.html">
 <span class="dropdown-text">Assignment 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-05-logistic-regression.html">
 <span class="dropdown-text">Assignment 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-06-lmer-unconditional-longitudinal-models.html">
 <span class="dropdown-text">Assignment 06</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments/assignment-07-longitudinal-analysis-ii.html">
 <span class="dropdown-text">Assignment 07</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../data.html">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">Instructor &amp; TA</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fixed-effects-regression-model" id="toc-fixed-effects-regression-model" class="nav-link active" data-scroll-target="#fixed-effects-regression-model">Fixed-Effects Regression Model</a>
  <ul class="collapse">
  <li><a href="#residual-analysis" id="toc-residual-analysis" class="nav-link" data-scroll-target="#residual-analysis">Residual Analysis</a></li>
  </ul></li>
  <li><a href="#conceptual-idea-of-mixed-effects-models" id="toc-conceptual-idea-of-mixed-effects-models" class="nav-link" data-scroll-target="#conceptual-idea-of-mixed-effects-models">Conceptual Idea of Mixed-Effects Models</a></li>
  <li><a href="#fitting-the-mixed-effects-regression-model-in-practice" id="toc-fitting-the-mixed-effects-regression-model-in-practice" class="nav-link" data-scroll-target="#fitting-the-mixed-effects-regression-model-in-practice">Fitting the Mixed-Effects Regression Model in Practice</a></li>
  <li><a href="#random-effects-for-intercept-and-grade-level" id="toc-random-effects-for-intercept-and-grade-level" class="nav-link" data-scroll-target="#random-effects-for-intercept-and-grade-level">Random Effects for Intercept and Grade Level</a></li>
  <li><a href="#looking-forward" id="toc-looking-forward" class="nav-link" data-scroll-target="#looking-forward">Looking Forward</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Mixed-Effects Models</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>In this set of notes, you will learn the conceptual ideas behind <em>linear mixed-effects models</em>, also called <em>multilevel models</em> or <em>hierarchical linear models</em>. To do this, we will use data from the file <em>minneapolis.csv</em>.</p>
<ul>
<li><a href="https://raw.githubusercontent.com/zief0002/bespectacled-antelope/main/data/minneapolis.csv">minneapolis.csv</a></li>
<li><a href="http://zief0002.github.io/bespectacled-antelope/codebooks/minneapolis.html">Codebook</a></li>
</ul>
<p>These data include repeated measurements of vertically scaled reading achievement scores for <span class="math inline">\(n=22\)</span> students. We will use these data to explore the question of whether students’ reading achievement is changing over time.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed) <span class="co">#for tidy, glance, and augment with lmer models</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(educate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4) <span class="co">#for fitting mixed-effects models</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>mpls <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"https://raw.githubusercontent.com/zief0002/bespectacled-antelope/main/data/minneapolis.csv"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View data</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>mpls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["student_id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["reading_score"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["grade"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["special_ed"],"name":[4],"type":["chr"],"align":["left"]},{"label":["attendance"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"172","3":"5","4":"No","5":"0.94"},{"1":"1","2":"185","3":"6","4":"No","5":"0.94"},{"1":"1","2":"179","3":"7","4":"No","5":"0.94"},{"1":"1","2":"194","3":"8","4":"No","5":"0.94"},{"1":"2","2":"200","3":"5","4":"No","5":"0.91"},{"1":"2","2":"210","3":"6","4":"No","5":"0.91"},{"1":"2","2":"209","3":"7","4":"No","5":"0.91"},{"1":"2","2":"210","3":"8","4":"No","5":"0.91"},{"1":"3","2":"191","3":"5","4":"No","5":"0.97"},{"1":"3","2":"199","3":"6","4":"No","5":"0.97"},{"1":"3","2":"203","3":"7","4":"No","5":"0.97"},{"1":"3","2":"215","3":"8","4":"No","5":"0.97"},{"1":"4","2":"200","3":"5","4":"No","5":"0.88"},{"1":"4","2":"195","3":"6","4":"No","5":"0.88"},{"1":"4","2":"194","3":"7","4":"No","5":"0.88"},{"1":"4","2":"195","3":"8","4":"No","5":"0.88"},{"1":"5","2":"207","3":"5","4":"No","5":"0.85"},{"1":"5","2":"213","3":"6","4":"No","5":"0.85"},{"1":"5","2":"212","3":"7","4":"No","5":"0.85"},{"1":"5","2":"213","3":"8","4":"No","5":"0.85"},{"1":"6","2":"191","3":"5","4":"No","5":"0.90"},{"1":"6","2":"189","3":"6","4":"No","5":"0.90"},{"1":"6","2":"206","3":"7","4":"No","5":"0.90"},{"1":"6","2":"195","3":"8","4":"No","5":"0.90"},{"1":"7","2":"199","3":"5","4":"No","5":"0.97"},{"1":"7","2":"208","3":"6","4":"No","5":"0.97"},{"1":"7","2":"213","3":"7","4":"No","5":"0.97"},{"1":"7","2":"218","3":"8","4":"No","5":"0.97"},{"1":"8","2":"191","3":"5","4":"Yes","5":"0.97"},{"1":"8","2":"194","3":"6","4":"Yes","5":"0.97"},{"1":"8","2":"194","3":"7","4":"Yes","5":"0.97"},{"1":"8","2":"193","3":"8","4":"Yes","5":"0.97"},{"1":"9","2":"149","3":"5","4":"Yes","5":"0.97"},{"1":"9","2":"154","3":"6","4":"Yes","5":"0.97"},{"1":"9","2":"174","3":"7","4":"Yes","5":"0.97"},{"1":"9","2":"177","3":"8","4":"Yes","5":"0.97"},{"1":"10","2":"200","3":"5","4":"No","5":"0.96"},{"1":"10","2":"212","3":"6","4":"No","5":"0.96"},{"1":"10","2":"213","3":"7","4":"No","5":"0.96"},{"1":"10","2":"215","3":"8","4":"No","5":"0.96"},{"1":"11","2":"218","3":"5","4":"No","5":"0.98"},{"1":"11","2":"231","3":"6","4":"No","5":"0.98"},{"1":"11","2":"233","3":"7","4":"No","5":"0.98"},{"1":"11","2":"239","3":"8","4":"No","5":"0.98"},{"1":"12","2":"228","3":"5","4":"Yes","5":"0.96"},{"1":"12","2":"232","3":"6","4":"Yes","5":"0.96"},{"1":"12","2":"248","3":"7","4":"Yes","5":"0.96"},{"1":"12","2":"246","3":"8","4":"Yes","5":"0.96"},{"1":"13","2":"228","3":"5","4":"No","5":"0.99"},{"1":"13","2":"236","3":"6","4":"No","5":"0.99"},{"1":"13","2":"228","3":"7","4":"No","5":"0.99"},{"1":"13","2":"239","3":"8","4":"No","5":"0.99"},{"1":"14","2":"199","3":"5","4":"No","5":"0.99"},{"1":"14","2":"210","3":"6","4":"No","5":"0.99"},{"1":"14","2":"225","3":"7","4":"No","5":"0.99"},{"1":"14","2":"235","3":"8","4":"No","5":"0.99"},{"1":"15","2":"218","3":"5","4":"No","5":"1.00"},{"1":"15","2":"223","3":"6","4":"No","5":"1.00"},{"1":"15","2":"236","3":"7","4":"No","5":"1.00"},{"1":"15","2":"227","3":"8","4":"No","5":"1.00"},{"1":"16","2":"228","3":"5","4":"No","5":"0.97"},{"1":"16","2":"226","3":"6","4":"No","5":"0.97"},{"1":"16","2":"234","3":"7","4":"No","5":"0.97"},{"1":"16","2":"227","3":"8","4":"No","5":"0.97"},{"1":"17","2":"201","3":"5","4":"No","5":"0.98"},{"1":"17","2":"210","3":"6","4":"No","5":"0.98"},{"1":"17","2":"208","3":"7","4":"No","5":"0.98"},{"1":"17","2":"219","3":"8","4":"No","5":"0.98"},{"1":"18","2":"218","3":"5","4":"No","5":"1.00"},{"1":"18","2":"220","3":"6","4":"No","5":"1.00"},{"1":"18","2":"217","3":"7","4":"No","5":"1.00"},{"1":"18","2":"221","3":"8","4":"No","5":"1.00"},{"1":"19","2":"215","3":"5","4":"No","5":"0.96"},{"1":"19","2":"216","3":"6","4":"No","5":"0.96"},{"1":"19","2":"221","3":"7","4":"No","5":"0.96"},{"1":"19","2":"224","3":"8","4":"No","5":"0.96"},{"1":"20","2":"204","3":"5","4":"No","5":"0.95"},{"1":"20","2":"215","3":"6","4":"No","5":"0.95"},{"1":"20","2":"219","3":"7","4":"No","5":"0.95"},{"1":"20","2":"214","3":"8","4":"No","5":"0.95"},{"1":"21","2":"237","3":"5","4":"No","5":"0.98"},{"1":"21","2":"241","3":"6","4":"No","5":"0.98"},{"1":"21","2":"243","3":"7","4":"No","5":"0.98"},{"1":"21","2":"243","3":"8","4":"No","5":"0.98"},{"1":"22","2":"219","3":"5","4":"No","5":"0.96"},{"1":"22","2":"233","3":"6","4":"No","5":"0.96"},{"1":"22","2":"236","3":"7","4":"No","5":"0.96"},{"1":"22","2":"243","3":"8","4":"No","5":"0.96"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<section id="fixed-effects-regression-model" class="level1">
<h1>Fixed-Effects Regression Model</h1>
<p>To examine the research question of whether students’ reading achivement scores are changing over time, we might try regressing reading achievement scores on grade-level predict using the <code>lm()</code> function. The <code>lm()</code> function fits a <em>fixed-effects regression model</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit fixed-effects model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(reading_score <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> grade, <span class="at">data =</span> mpls)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Model-level output</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[11],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[12],"type":["int"],"align":["right"]}],"data":[{"1":"0.06083072","2":"0.04991015","3":"19.39126","4":"5.570286","5":"0.0205307","6":"1","7":"-384.7594","8":"775.5189","9":"782.9509","10":"32337.82","11":"86","12":"88"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficient-level output</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"184.272727","3":"12.194231","4":"15.111468","5":"6.241145e-26"},{"1":"grade","2":"4.363636","3":"1.848885","4":"2.360145","5":"2.053070e-02"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The model-level summary information suggests that differences in grade-level explains 6.08% of the variation in reading achievement scores. The fitted equation based on the coefficient-level output is:</p>
<p><span class="math display">\[
\hat{\mathrm{Reading~Score}}_i = 184 + 4.36(\mathrm{Grade}_i)
\]</span></p>
<p>The intercept suggests that the reading achievement score for students in the 0th grade (<code>grade</code>=0) is 184, on average. The slope indicates that each one-grade difference is associated with a change in reading achievement of 4.36 points, on average. To have faith in the analytic results from this model, we need to evaluate whether the assumptions are satisfied.</p>
<p><br></p>
<section id="residual-analysis" class="level2">
<h2 class="anchored" data-anchor-id="residual-analysis">Residual Analysis</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Augment the model</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">augment</span>(lm<span class="fl">.1</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plot</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> out, <span class="fu">aes</span>(<span class="at">x =</span> .std.resid)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  educate<span class="sc">::</span><span class="fu">stat_density_confidence</span>(<span class="at">model =</span> <span class="st">"normal"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Standardized residuals"</span>) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability density"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> out, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .std.resid)) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"lightgrey"</span>) <span class="sc">+</span> <span class="co">#Create conf envelope for where the average residual should be</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Fitted values"</span>) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standardized residuals"</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Output plots</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuals-fixed" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-introduction-to-mixed-effects-models_files/figure-html/fig-residuals-fixed-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Residual plots for the fixed-effects regression model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="fyi">
<p>Because the loess smoother completely changes the scale, the <code>residual_plots()</code> function does not work here, so I created the residual plots by hand.</p>
</div>
<p>The assumption that the mean residual is 0 seems reasonably satisfied, as does the tenability of the normality and homoscedasticity assumptions. However, the assumption of independence (which we don’t evaluate from the common residual plots) is probably not tenable. Recall that the data includes multiple reading achievment scores for the same student. These scores (and thus the residuals) are probably correlated—this is a violation of independence which assumes that the correlation between each set of residuals is 0.</p>
<p>Because we have a variable that identifies each student, we can actually examine this by plotting the residuals separately for each student. To do so we need to include the <code>student_id</code> variable as a new column in the augmented data (using <code>mutate()</code>) so we can show the residuals versus the fitted values by student.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Augment the model and mutate on student ID</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">augment</span>(lm<span class="fl">.1</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">student_id =</span> mpls<span class="sc">$</span>student_id)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Show residuals by student</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> out, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .std.resid)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Fitted values"</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Studentized residuals"</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>student_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuals-by-student" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-introduction-to-mixed-effects-models_files/figure-html/fig-residuals-by-student-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Scatterplots of the standardized residuals versus the fitted values for 22 students.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The residuals for several of the students show a systematic trends of being primarily positive or negative within students. For example, the residuals for several students (e.g., Sudents 1, 3, 4, 6, 8, 9) are primarily negative. Knowing that a residual is negative gives us information that other residuals for that student are also negative. There are similar trends for students that have positive residuals. This is a sign of non-independence of the residuals. If we hadn’t had the student ID variable we could have still made a logical argument about this non-independence via substantive knowledge. For example, students who perform above average in Grade 5 will likely tend to perform well in subsequent grades (i.e., have positive residuals) relative to the population. Similarly, students who perform below average in 5th grade will tend to perform below average, relative to the population, in other grades. That is, a student’s reading achievement scores across grade levels tend to be correlated.</p>
<p>To account for this within-student correlation we need to use a statistical model that accounts for the correlation among the residuals within student. This is what <em>mixed-effects models</em> bring to the table. By correctly modeling the non-independence, we get more accurate standard errors and <em>p</em>-values.</p>
<p>Another benefit of using mixed-effects models is that we also get estimates of the variation accounted for at both the between- and within-student levels. This disaggregation of the variation allows us to determine which level is explaining more variation and to study predictors appropriate to explaining that variation. For example, suppose that you disaggregated the variation in reading achievement scores and found that:</p>
<ul>
<li>82% of the variation in these scores was at the within-student level, and</li>
<li>18% of the variation in these scores was at the between-student level.</li>
</ul>
<p>We could conclude that most of the variation in reading achievement scores is within-student, which means that we would be better off thinking about within-student predictors. (These are predictors that may vary across grade-levels for a given student.) The only within-student predictor in our example data is grade-level. Both special education status, and attendance are between-student predictors—they vary for different students, but have the same value for any one student. By including between-student predictors in the model, you would only be “chipping away” at that 18% of the variation that is between-student variation. This type of decompostion of the unexplained variation helps focus your attention and resources on the levels of variation that matter!</p>
<div class="fyi">
<p>Within- and between-student predictors go by many other names. Other names for these predictors are <em>time-varying predictors</em> (within-student) and <em>non-time-varying</em> (between-students) predictors. Also level-1 (within-student) and level-2 (between-student) predictors.</p>
</div>
<p><br></p>
</section>
</section>
<section id="conceptual-idea-of-mixed-effects-models" class="level1">
<h1>Conceptual Idea of Mixed-Effects Models</h1>
<p>In this section we will outline the conceptual ideas behind mixed-effects models by linking the ideas behind these models to the conventional, fixed-effects regression model. <em>It is important to realize that this is just conceptual in nature. Its purpose is only to help you understand the output you get from a mixed-effects model analysis. It is NOT how we carry out a mixed-effects analysis.</em></p>
<p>To begin, we remind you of the fitted equation we obtained earlier from the fixed-effects regression:</p>
<p><span class="math display">\[
\hat{\mathrm{Reading~Score}}_i = 184 + 4.36(\mathrm{Grade}_i)
\]</span></p>
<p>This is the fitted equation from the <em>global model</em>, so called because it was fitted with the data from all time points across all students. As such, the intercept and slope estimates from this equation are averaged across time grade levels and students.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Mixed-effects regression conceptually fits a global model (like the one above) AND a set of student-specific models, one for each student. The student-specific model is akin to fitting a regression model for each student separately. Below I show the results (for five of the students) of fitting a different regression model to each student, but keep in mind that this is not actually what happens; it is only to help you understand.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit student models</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>student_models <span class="ot">=</span> mpls <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(student_id) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>(<span class="fu">lm</span>(reading_score  <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> grade))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View coefficients from fitted models</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>student_models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["student_id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"(Intercept)","3":"143.5","4":"18.7709883","5":"7.6447760","6":"0.0166837971"},{"1":"1","2":"grade","3":"6.0","4":"2.8460499","5":"2.1081851","6":"0.1695452015"},{"1":"2","2":"(Intercept)","3":"188.4","4":"11.1734059","5":"16.8614656","6":"0.0034988506"},{"1":"2","2":"grade","3":"2.9","4":"1.6941074","5":"1.7118159","6":"0.2290614228"},{"1":"3","2":"(Intercept)","3":"152.6","4":"6.9799713","5":"21.8625539","6":"0.0020856330"},{"1":"3","2":"grade","3":"7.6","4":"1.0583005","5":"7.1813250","6":"0.0188442190"},{"1":"4","2":"(Intercept)","3":"206.4","4":"6.3261363","5":"32.6265498","6":"0.0009380938"},{"1":"4","2":"grade","3":"-1.6","4":"0.9591663","5":"-1.6681153","6":"0.2372299286"},{"1":"5","2":"(Intercept)","3":"200.2","4":"6.6936537","5":"29.9089270","6":"0.0011160171"},{"1":"5","2":"grade","3":"1.7","4":"1.0148892","5":"1.6750598","6":"0.2359068225"},{"1":"6","2":"(Intercept)","3":"176.4","4":"23.8441817","5":"7.3980312","6":"0.0177852462"},{"1":"6","2":"grade","3":"2.9","4":"3.6152455","5":"0.8021585","6":"0.5066285982"},{"1":"7","2":"(Intercept)","3":"169.2","4":"4.5694639","5":"37.0284141","6":"0.0007285426"},{"1":"7","2":"grade","3":"6.2","4":"0.6928203","5":"8.9489292","6":"0.0122578688"},{"1":"8","2":"(Intercept)","3":"189.1","4":"4.2743421","5":"44.2407270","6":"0.0005105318"},{"1":"8","2":"grade","3":"0.6","4":"0.6480741","5":"0.9258201","6":"0.4522774425"},{"1":"9","2":"(Intercept)","3":"95.9","4":"15.0688420","5":"6.3641254","6":"0.0238117535"},{"1":"9","2":"grade","3":"10.4","4":"2.2847319","5":"4.5519563","6":"0.0450272158"},{"1":"10","2":"(Intercept)","3":"180.1","4":"11.8351172","5":"15.2174242","6":"0.0042905763"},{"1":"10","2":"grade","3":"4.6","4":"1.7944358","5":"2.5634798","6":"0.1244049642"},{"1":"11","2":"(Intercept)","3":"188.0","4":"10.1106380","5":"18.5942767","6":"0.0028797994"},{"1":"11","2":"grade","3":"6.5","4":"1.5329710","5":"4.2401325","6":"0.0513728321"},{"1":"12","2":"(Intercept)","3":"193.0","4":"15.3264477","5":"12.5926114","6":"0.0062471773"},{"1":"12","2":"grade","3":"7.0","4":"2.3237900","5":"3.0123204","6":"0.0947939498"},{"1":"13","2":"(Intercept)","3":"216.5","4":"16.6200181","5":"13.0264600","6":"0.0058415584"},{"1":"13","2":"grade","3":"2.5","4":"2.5199206","5":"0.9920947","6":"0.4257045156"},{"1":"14","2":"(Intercept)","3":"137.3","4":"4.3249277","5":"31.7461951","6":"0.0009907654"},{"1":"14","2":"grade","3":"12.3","4":"0.6557439","5":"18.7573242","6":"0.0028301633"},{"1":"15","2":"(Intercept)","3":"200.0","4":"20.2212759","5":"9.8905727","6":"0.0100683744"},{"1":"15","2":"grade","3":"4.0","4":"3.0659419","5":"1.3046561","6":"0.3219364964"},{"1":"16","2":"(Intercept)","3":"225.5","4":"12.7720398","5":"17.6557546","6":"0.0031925945"},{"1":"16","2":"grade","3":"0.5","4":"1.9364917","5":"0.2581989","6":"0.8203946980"},{"1":"17","2":"(Intercept)","3":"175.7","4":"11.3855171","5":"15.4318858","6":"0.0041728903"},{"1":"17","2":"grade","3":"5.2","4":"1.7262677","5":"3.0122791","6":"0.0947961890"},{"1":"18","2":"(Intercept)","3":"215.1","4":"5.9724367","5":"36.0154508","6":"0.0007700526"},{"1":"18","2":"grade","3":"0.6","4":"0.9055385","5":"0.6625892","6":"0.5757359313"},{"1":"19","2":"(Intercept)","3":"198.2","4":"3.4899857","5":"56.7910641","6":"0.0003099118"},{"1":"19","2":"grade","3":"3.2","4":"0.5291503","5":"6.0474316","6":"0.0262710089"},{"1":"20","2":"(Intercept)","3":"190.9","4":"16.7113734","5":"11.4233580","6":"0.0075762623"},{"1":"20","2":"grade","3":"3.4","4":"2.5337719","5":"1.3418730","6":"0.3116901193"},{"1":"21","2":"(Intercept)","3":"228.0","4":"4.1713307","5":"54.6588164","6":"0.0003345504"},{"1":"21","2":"grade","3":"2.0","4":"0.6324555","5":"3.1622777","6":"0.0871290708"},{"1":"22","2":"(Intercept)","3":"184.0","4":"10.1106380","5":"18.1986538","6":"0.0030057990"},{"1":"22","2":"grade","3":"7.5","4":"1.5329710","5":"4.8924605","6":"0.0393296024"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>As an example, let’s focus on the fitted model for Student 1.</p>
<p><span class="math display">\[
\mathbf{Student~1:}~~\hat{\mathrm{Reading~Score}_i} = 144 + 6.00(\mathrm{Grade}_i)
\]</span></p>
<p>Comparing this student-specific model to the global model, we find that Student 1’s intercept is lower than the intercept from the global model (by 40 points) and Student 1’s slope is higher than the slope from the global model (by 1.64). We can actually re-write the Student 1’s student-specific model using these ideas:</p>
<p><span class="math display">\[
\mathbf{Student~1:}~~\hat{\mathrm{Reading~Score}_i} = \bigg[184 - 40\bigg] + \bigg[4.36 + 1.64\bigg](\mathrm{Grade}_i)
\]</span></p>
<p>In the language of mixed-effects modeling:</p>
<ul>
<li>The global intercept and slope are referred to as <em>fixed-effects</em>. (These are also sometimes referred to as <em>between-groups</em> effects.)
<ul>
<li>The fixed-effect of intercept is 184; and</li>
<li>The fixed effect of the slope is 4.36.</li>
</ul></li>
<li>The student-specific deviations from the fixed-effect values are referred to as <em>random-effects</em>. (These are also sometimes referred to as <em>within-groups</em> effects.)
<ul>
<li>The random-effect of the intercept for Student 1 is <span class="math inline">\(-40\)</span>; and</li>
<li>The random-effect of the slope for Student 1 is 1.64.</li>
</ul></li>
</ul>
<p>Writing the student-specific fitted equation for Student 2 in this manner:</p>
<p><span class="math display">\[
\begin{split}
\mathbf{Student~2:}~~\hat{\mathrm{Reading~Score}_i} &amp;= 188 + 2.90(\mathrm{Grade}_i)\\
&amp;= \bigg[184 + 4\bigg] + \bigg[4.36 - 1.46\bigg](\mathrm{Grade}_i)\\
\end{split}
\]</span></p>
<p>In this model:</p>
<ul>
<li>The fixed-effects (global effects) are the same as they were for Student 1.
<ul>
<li>The fixed-effect of intercept is 184; and</li>
<li>The fixed effect of the slope is 4.36.</li>
</ul></li>
<li>The random-effect of intercept for Student 2 is 4.</li>
<li>The random-effect of slope for Student 2 is <span class="math inline">\(-1.46\)</span>.</li>
</ul>
<p>The fixed-effects (effects from the global model) are the same across all students. The random-effects, which represent the deviation between the global effects and the effects in a particular student’s equation, vary across students. That is, each student could potentially have a different random-effect for intercept and slope.</p>
<p><br></p>
</section>
<section id="fitting-the-mixed-effects-regression-model-in-practice" class="level1">
<h1>Fitting the Mixed-Effects Regression Model in Practice</h1>
<p>In practice, we use the <code>lmer()</code> function from the <code>{lme4}</code> library to fit mixed-effect regression models. This function will essentially do what we did in the previous section, but rather than independently fitting the student-specific models, it will fit all these models simultaneously and make use of the information in all the clusters (students) to do this. This will result in better estimates for both the fixed- and random-effects.</p>
<p>The syntax looks similar to the syntax we use in <code>lm()</code> except now we split it into two parts. The first part of the syntax gives a model formula to specify the outcome and fixed-effects included in the model. This is identical to the syntax we used in the <code>lm()</code> function. In our example: <code>reading_score ~ 1 + grade</code> indicating that we want to fit a model that includes fixed-effects for both the intercept and the effect of grade level.</p>
<p>We also have to declare that we want to fit a model for each student. To do this, we will include a random-effect for intercept. (We could also include a random-effect of grade, but to keep it simpler right now, we only include the RE of intercept.) The second part of the syntax declares this: <code>(1 | student_id)</code>. This says to fit student-specific models that vary in their intercepts. This is literally added to the fixed-effects formula using <code>+</code>. The complete syntax is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit mixed-effects regression model</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lmer<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lmer</span>(reading_score <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> grade <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> student_id), <span class="at">data =</span> mpls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To view the fixed-effects, we use the <code>tidy()</code> function from the <code>{broom.mixed}</code> package with the argument <code>effects="fixed"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lmer<span class="fl">.1</span>, <span class="at">effects =</span> <span class="st">"fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"fixed","2":"(Intercept)","3":"184.272727","4":"5.2997063","5":"34.77037"},{"1":"fixed","2":"grade","3":"4.363636","4":"0.5252312","5":"8.30803"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This gives the coefficients for the fixed-effects part of the model (i.e., the global model),</p>
<p><span class="math display">\[
\mathbf{Fixed\mbox{-}Effects~Equation:}~~\hat{\mathrm{Reading~Score}_{ij}} = 184.27 + 4.36(\mathrm{Grade}_{ij})
\]</span></p>
<p>Note that the notation now includes two subscripts. The <em>i</em> subscript now indicates the <em>i</em>th time point (grade level), and the new <em>j</em> subscript indicates Student <em>J</em>. We interpret these coefficients from the fixed-effects equation exactly like <code>lm()</code> coefficients. Here,</p>
<ul>
<li>The reading achievement score for students in Grade 0 is 184.27, on average.</li>
<li>Each one-grade difference is associated with a 4.36-point difference in reading achievement score, on average.</li>
</ul>
<p>To view the student-specific random-effects, we again use the <code>tidy()</code> function from the <code>{broom.mixed}</code> package, but this time with the argument <code>effects="ran_vals"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lmer<span class="fl">.1</span>, <span class="at">effects =</span> <span class="st">"ran_vals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["level"],"name":[3],"type":["chr"],"align":["left"]},{"label":["term"],"name":[4],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"ran_vals","2":"student_id","3":"1","4":"(Intercept)","5":"-29.503915","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"2","4":"(Intercept)","5":"-5.273324","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"3","4":"(Intercept)","5":"-10.413146","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"4","4":"(Intercept)","5":"-16.287229","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"5","4":"(Intercept)","5":"-1.357269","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"6","4":"(Intercept)","5":"-17.021489","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"7","4":"(Intercept)","5":"-3.070543","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"8","4":"(Intercept)","5":"-19.224270","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"9","4":"(Intercept)","5":"-48.105177","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"10","4":"(Intercept)","5":"-2.581036","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"11","4":"(Intercept)","5":"17.243993","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"12","4":"(Intercept)","5":"25.320856","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"13","4":"(Intercept)","5":"19.691527","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"14","4":"(Intercept)","5":"4.516814","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"15","4":"(Intercept)","5":"13.083184","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"16","4":"(Intercept)","5":"15.775472","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"17","4":"(Intercept)","5":"-3.070543","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"18","4":"(Intercept)","5":"6.230088","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"19","4":"(Intercept)","5":"6.230088","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"20","4":"(Intercept)","5":"0.356005","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"21","4":"(Intercept)","5":"27.768391","6":"2.725281"},{"1":"ran_vals","2":"student_id","3":"22","4":"(Intercept)","5":"19.691527","6":"2.725281"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The random-effects indicate how the student-specific intercept <em>differs</em> from the intercept in the fixed-effects equation (which is the average intercept across students). From the estimated fixed- and random-effects, we can re-construct each student-specific fitted equation. For example, to construct the student-specific fitted equation for Student 1, we combine the estimated coefficients for the fixed-effects and the estimated random-effect for Student 1:</p>
<p><span class="math display">\[
\begin{split}
\mathbf{Student~1:}~~\hat{\mathrm{Reading~Score}_{i1}} &amp;= \bigg[184.27 - 29.50 \bigg]+ 4.36(\mathrm{Grade}_{i1}) \\[1ex]
&amp;= 154.77 + 4.36(\mathrm{Grade}_{i1})
\end{split}
\]</span></p>
<p>In this notation, the <em>j</em> part of the subscript is now set to 1 since it refers to Student 1. (If the student is identified as “Student 1” <em>j</em> part of the subscript could also be dropped entirely.) We can also interpret the coefficients from the fitted student-specific equation:</p>
<ul>
<li>The reading achievement score for Student 1 in Grade 0 is 154.77, on average.</li>
<li>For Student 1, each one-grade difference is associated with a 4.36-point difference in reading achievement score, on average.</li>
</ul>
<p>These interpretations are similar to those for the fixed-effects, but they are in refrence to a specific student, namely Student 1. We can also interpret the difference between the coefficients in the global equation and the student-specific equation:</p>
<ul>
<li>The reading achievement score for Student 1 in Grade 0 is 29.50 points lower than the average reading score of students in Grade 0.</li>
<li>Student 1’s rate-of-growth (4.36 points per grade level) is exactly the same as the average rate-of-growth. (In fact all students would have the same average predicted rate-of-growth in this model.)</li>
</ul>
<p>These interpretations are the interpretations of the random-effects.</p>
<p><br></p>
</section>
<section id="random-effects-for-intercept-and-grade-level" class="level1">
<h1>Random Effects for Intercept and Grade Level</h1>
<p>If we want to include both a random effect for intercept and grade level (i.e., allow the student-specific equations to have different intercept and slopes), we need to specify this in the random-effects part of the syntax: <code>(1 + grade | student_id)</code>. This says to fit student-specific models that vary in their intercepts and in their effects for grade level. The complete syntax is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit mixed-effects regression model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lmer<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lmer</span>(reading_score <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> grade <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> grade <span class="sc">|</span> student_id), <span class="at">data =</span> mpls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To view the fixed-effects, we again use the <code>tidy()</code> function with <code>effects="fixed"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lmer<span class="fl">.2</span>, <span class="at">effects =</span> <span class="st">"fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"fixed","2":"(Intercept)","3":"184.272727","4":"6.5836025","5":"27.98965"},{"1":"fixed","2":"grade","3":"4.363636","4":"0.7203953","5":"6.05728"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This fitted equation for the fixed-effects part of the model (i.e., the global model) is:</p>
<p><span class="math display">\[
\mathbf{Fixed\mbox{-}Effects~Equation:}~~\hat{\mathrm{Reading~Score}_{ij}} = 184.27 + 4.36(\mathrm{Grade}_{ij})
\]</span></p>
<p>The fixed-effects did not change much from our initial model (sometimes they do). They have the same interpretations as in <code>lmer.1</code>. To view the student-specific random-effects, we use the <code>tidy()</code> function with <code>effects="ran_vals"</code>. We pipe this output into <code>arrange()</code> to order the output by student ID values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lmer<span class="fl">.2</span>, <span class="at">effects =</span> <span class="st">"ran_vals"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(level)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["level"],"name":[3],"type":["chr"],"align":["left"]},{"label":["term"],"name":[4],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"ran_vals","2":"student_id","3":"1","4":"(Intercept)","5":"-38.5141121","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"1","4":"grade","5":"1.3439617","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"10","4":"(Intercept)","5":"-3.7860708","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"10","4":"grade","5":"0.1815651","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"11","4":"(Intercept)","5":"8.6804695","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"11","4":"grade","5":"1.3377901","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"12","4":"(Intercept)","5":"14.9849869","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"12","4":"grade","5":"1.6206833","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"13","4":"(Intercept)","5":"29.1549485","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"13","4":"grade","5":"-1.4266451","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"14","4":"(Intercept)","5":"-30.7124453","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"14","4":"grade","5":"5.4148283","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"15","4":"(Intercept)","5":"15.4599683","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"15","4":"grade","5":"-0.3474454","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"16","4":"(Intercept)","5":"33.9574325","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"16","4":"grade","5":"-2.7704427","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"17","4":"(Intercept)","5":"-6.9866416","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"17","4":"grade","5":"0.5971451","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"18","4":"(Intercept)","5":"23.4171529","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"18","4":"grade","5":"-2.6304377","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"19","4":"(Intercept)","5":"11.7909278","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"19","4":"grade","5":"-0.8454468","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"2","4":"(Intercept)","5":"0.9689152","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"2","4":"grade","5":"-0.9654197","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"20","4":"(Intercept)","5":"4.6854538","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"20","4":"grade","5":"-0.6642312","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"21","4":"(Intercept)","5":"39.9310909","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"21","4":"grade","5":"-1.8302869","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"22","4":"(Intercept)","5":"6.7968232","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"22","4":"grade","5":"2.0060299","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"3","4":"(Intercept)","5":"-25.4824779","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"3","4":"grade","5":"2.2997148","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"4","4":"(Intercept)","5":"9.4453235","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"4","4":"grade","5":"-3.9724985","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"5","4":"(Intercept)","5":"10.4756312","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"5","4":"grade","5":"-1.8185340","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"6","4":"(Intercept)","5":"-11.4533828","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"6","4":"grade","5":"-0.8776025","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"7","4":"(Intercept)","5":"-11.4582666","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"7","4":"grade","5":"1.2836801","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"8","4":"(Intercept)","5":"-3.4978261","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"8","4":"grade","5":"-2.4401673","6":"1.553919"},{"1":"ran_vals","2":"student_id","3":"9","4":"(Intercept)","5":"-77.8579008","6":"10.333435"},{"1":"ran_vals","2":"student_id","3":"9","4":"grade","5":"4.5037594","6":"1.553919"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Now there are two columns of output in the random-effects. The value in the <code>(Intercept)</code> column indicates how the student-specific intercept differs from the intercept in the fixed-effects equation. The value in the <code>grade</code> column indicates how the student-specific grade level effect differs from the grade level in the fixed-effects equation.</p>
<p>For example, based on the random-effects for Student 1:</p>
<ul>
<li>Student 1’s intercept is <span class="math inline">\(38.51\)</span>-points lower than the average intercept of 184.27.</li>
<li>Student 1’s grade level effect is <span class="math inline">\(1.34\)</span>-points higher than the average grade level effect of 4.36.</li>
</ul>
<p>This implies that, on average, Student 1’s reading achievement score in Grade 0, is 38.51 points lower than their peers (extrapolation). But, their rate-of-growth is 1.34 points-per-grade level higher than their peers.</p>
<p>Writing the student-specific fitted equation for Student 1:</p>
<p><span class="math display">\[
\begin{split}
\mathbf{Student~1:}~~\hat{\mathrm{Reading~Score}_{i}} &amp;= \bigg[184.27 - 38.51 \bigg] + \bigg[4.36 + 1.34\bigg](\mathrm{Grade}_{i}) \\[1ex]
&amp;= 145.76 + 5.70(\mathrm{Grade}_{i})
\end{split}
\]</span></p>
</section>
<section id="looking-forward" class="level1">
<h1>Looking Forward</h1>
<p>The mixed-effects model accounts for non-independence by including one or more random effects into the regression model. Over the next several sets of notes, we will learn how to determine whether we should include only a random effect of intercept, or whether we should also allow other effects in the model (e.g., grade level?) to also have a random effect. You will also learn how to do the decomposition of variation into within- and between-subjects components.</p>
<p>As with any other statistical model, the mixed-effects model has a set of assumptions that we need to evaluate. You will learn what those assumptions are, and how to evaluate them. We will also learn about different ways of mathematically expressing this model, and how to present the results from our fitted equations.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Some authors refer to this as a completely pooled model or the mean model.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>